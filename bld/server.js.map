{"version":3,"sources":["webpack:///webpack/bootstrap 1926f21a67fbea0843f1","webpack:///./src/server.js","webpack:///./~/dotenv/config.js","webpack:///./~/dotenv/lib/main.js","webpack:///external \"fs\"","webpack:///external \"bunyan\"","webpack:///./src/YelpRest.js","webpack:///./src/Yelp.js","webpack:///external \"querystring\"","webpack:///external \"oauth\"","webpack:///external \"lodash\"","webpack:///external \"express\"","webpack:///external \"cluster\"","webpack:///external \"os\""],"names":[],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 1926f21a67fbea0843f1\n **/","//import 'source-map-support/register';\nimport 'dotenv/config';\nimport bunyan from 'bunyan';\nimport YelpRest from './YelpRest';\nimport express from 'express';\n\nconst cluster = require('cluster');\nconst numCPUs = require('os').cpus().length;\n// Number of workers, equals number of cores if not specified in .env\nconst numWorkers = process.env.NUM_WORKERS || numCPUs;\n\nif (cluster.isMaster) {\n  // Create logger\n  let ringbuffer = new bunyan.RingBuffer({limit: 100});\n  let log = bunyan.createLogger({\n    name: `Yelp Rest Server Master ${process.pid}`,\n    streams: [\n      {\n        level: 'info',\n        stream: process.stdout\n      },\n      {\n        level: 'trace',\n        type: 'raw',\n        stream: ringbuffer\n      }\n    ]\n  });\n  // Fork workers.\n  for (var i = 0; i < numWorkers; i++) {\n    log.info(`Populating worker ${i}`);\n    cluster.fork();\n  }\n  cluster.on('exit', (worker, code, signal) => {\n    log.info(`YRS Worker ${worker.process.pid} died`);\n  });\n} else {\n  // Instantiate express app\n  let app = express();\n  app.set('port', process.env.PORT);\n\n  // Create logger\n  let ringbuffer = new bunyan.RingBuffer({limit: 100});\n  let log = bunyan.createLogger({\n    name: `YRS Worker ${process.pid}`,\n    streams: [\n      {\n        level: 'info',\n        stream: process.stdout\n      },\n      {\n        level: 'trace',\n        type: 'raw',\n        stream: ringbuffer\n      }\n    ]\n  });\n  app.set('log', log);\n\n  // Instantiate YelpRest\n  var yelpRest = new YelpRest({\n    yelpCredentials: {\n      consumer_key: process.env.YELP_CONSUMER_KEY,\n      consumer_secret: process.env.YELP_CONSUMER_SECRET,\n      token: process.env.YELP_TOKEN,\n      token_secret: process.env.YELP_TOKEN_SECRET\n    },\n    log\n  });\n\n  // Append search request handler\n  app.get('/api/search', yelpRest.search());\n\n  // Run the server\n  app.listen(process.env.PORT, (err) => {\n    if (err) {\n      log.error(err);\n      return;\n    }\n    log.info(`Server listening on port ${app.get('port')}...`);\n  });\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/server.js\n **/","(function () {\n  var options = {}\n  process.argv.forEach(function (val, idx, arr) {\n    var matches = val.match(/^dotenv_config_(.+)=(.+)/)\n    if (matches) {\n      options[matches[1]] = matches[2]\n    }\n  })\n\n  require('./lib/main').config(options)\n})()\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/dotenv/config.js\n **/","'use strict'\n\nvar fs = require('fs')\n\nmodule.exports = {\n  /*\n   * Main entry point into dotenv. Allows configuration before loading .env\n   * @param {Object} options - valid options: path ('.env'), encoding ('utf8')\n   * @returns {Boolean}\n  */\n  config: function (options) {\n    var path = '.env'\n    var encoding = 'utf8'\n    var silent = false\n\n    if (options) {\n      if (options.silent) {\n        silent = options.silent\n      }\n      if (options.path) {\n        path = options.path\n      }\n      if (options.encoding) {\n        encoding = options.encoding\n      }\n    }\n\n    try {\n      // specifying an encoding returns a string instead of a buffer\n      var parsedObj = this.parse(fs.readFileSync(path, { encoding: encoding }))\n\n      Object.keys(parsedObj).forEach(function (key) {\n        process.env[key] = process.env[key] || parsedObj[key]\n      })\n\n      return parsedObj\n    } catch (e) {\n      if (!silent) {\n        console.error(e)\n      }\n      return false\n    }\n  },\n\n  /*\n   * Parses a string or buffer into an object\n   * @param {String|Buffer} src - source to be parsed\n   * @returns {Object}\n  */\n  parse: function (src) {\n    var obj = {}\n\n    // convert Buffers before splitting into lines and processing\n    src.toString().split('\\n').forEach(function (line) {\n      // matching \"KEY' and 'VAL' in 'KEY=VAL'\n      var keyValueArr = line.match(/^\\s*([\\w\\.\\-]+)\\s*=\\s*(.*)?\\s*$/)\n      // matched?\n      if (keyValueArr != null) {\n        var key = keyValueArr[1]\n\n        // default undefined or missing values to empty string\n        var value = keyValueArr[2] ? keyValueArr[2] : ''\n\n        // expand newlines in quoted values\n        var len = value ? value.length : 0\n        if (len > 0 && value.charAt(0) === '\\\"' && value.charAt(len - 1) === '\\\"') {\n          value = value.replace(/\\\\n/gm, '\\n')\n        }\n\n        // remove any surrounding quotes and extra spaces\n        value = value.replace(/(^['\"]|['\"]$)/g, '').trim()\n\n        obj[key] = value\n      }\n    })\n\n    return obj\n  }\n\n}\n\nmodule.exports.load = module.exports.config\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/dotenv/lib/main.js\n **/","module.exports = require(\"fs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fs\"\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = require(\"bunyan\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"bunyan\"\n ** module id = 4\n ** module chunks = 0\n **/","import Yelp from './Yelp';\nimport _ from 'lodash';\n\nvar log;\n\n// Constanst for Yelp Search API https://www.yelp.com/developers/documentation/v2/search_api\nlet SORT_BEST_MATCHECED = 0;\nlet SORT_DISTANCE = 1;\nlet SORT_HIGHEST_RATED = 2;\n\n/**\n * YelpRest extends Yelp class to provide REST access to Yelp class functionality\n * @param {object} opts - The object, containing your Yelp credentials as subobject and logger\n * @param {object} opts.yelpCredentials - The object, containing your Yelp credentials\n * @param {string} opts.yelpCredentials.consumer_key - Consumer Key from Yelp's Manage API access\n * @param {string} opts.yelpCredentials.consumer_secret - Consumer Secret from Yelp's Manage API access\n * @param {string} opts.yelpCredentials.token - Token from Yelp's Manage API access\n * @param {string} opts.yelpCredentials.token_secret - Token Secret from Yelp's Manage API access\n */\nexport default class YelpRest extends Yelp {\n  constructor(opts) {\n    super(opts.yelpCredentials);\n    this.log = log = opts.log;\n  }\n\n  /**\n   * Get YelpRest parameters and map it to Yelp API parameters\n   * @param {object} query - Query parameters accepted by YelpRest server\n   * @returns {object} - Query parameters mapped to Yelp API\n   */\n  static queryToParamsMapper(query) {\n    query = _.clone(query);\n    if (!query.lat) return null;  // latitude required\n    if (!query.lng) return null;  // longitude required\n    let params = {\n      ll: `${query.lat},${query.lng}`,\n      // Sort by distance if not specified.\n      sort: typeof query.sort == 'undefined' ? SORT_DISTANCE : query.sort\n    };\n    delete query.lat;\n    delete query.lng;\n    delete query.sort;\n    // Push everything despite coordinates and sort method to search term\n    params.term = Object.keys(query).map((key) => `${key}+${query[key]}`).join('+');\n    log.info('do request to Yelp API, params =', params);\n    return params;\n  }\n\n  /**\n   * @returns {function(this:YelpRest)} -  YelpRest search request handler function\n   */\n  search() {\n    let search = super.search;\n    return function (req, res) {\n      log.info('got request, query =', req.query);\n      var params = YelpRest.queryToParamsMapper(req.query);\n      if (!params) {\n        var err = {error: 'Wrong query'};\n        log.error(err);\n        res.status(400).json(err);\n        return;\n      }\n      search.call(this, params)\n        .then((data) => {\n          res.json(data);\n        })\n        .catch((err) => {\n          log.error(err);\n          res.status(400).json(err);\n        });\n    }.bind(this);\n  }\n\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/YelpRest.js\n **/","import querystring from 'querystring';\nimport oauth from 'oauth';\n\nconst OAuth = oauth.OAuth;\n\nconst baseUrl = 'http://api.yelp.com/v2/';\n\n/**\n * Yelp class provides access to Yelp API\n * @param {object} opts - The object, containing your Yelp credentials\n * @param {string} opts.consumer_key - Consumer Key from Yelp's Manage API access\n * @param {string} opts.consumer_secret - Consumer Secret from Yelp's Manage API access\n * @param {string} opts.token - Token from Yelp's Manage API access\n * @param {string} opts.token_secret - Token Secret from Yelp's Manage API access\n */\nexport default class Yelp {\n  constructor(opts) {\n    this.oauthToken = opts.token;\n    this.oauthTokenSecret = opts.token_secret;\n    this.oauth = new OAuth(\n      null,\n      null,\n      opts.consumer_key,\n      opts.consumer_secret,\n      opts.version || '1.0',\n      null,\n      'HMAC-SHA1'\n    );\n  }\n\n  /**\n   * General Yelp API request\n   *\n   * @param {string} resource - Yelp API resource: search / buisiness/<id> / phone_search\n   * @param {object} params - Yelp API request parameters\n   * @param {function} cb - Callback function (optional)\n   * @returns {*}\n   */\n  get(resource, params = {}, cb) {\n    const promise = new Promise((resolve, reject) => {\n      const debug = params.debug;\n      delete params.debug;\n\n      this.oauth.get(\n        baseUrl + resource + '?' + querystring.stringify(params),\n        this.oauthToken,\n        this.oauthTokenSecret,\n        (err, _data, response) => {\n          if (err) return reject(err);\n          const data = JSON.parse(_data);\n          if (debug) return resolve([data, response]);\n          resolve(data);\n        }\n      );\n    });\n    if (typeof cb === 'function') {\n      promise\n        .then((res) => cb(null, res))\n        .catch(cb);\n      return null;\n    }\n    return promise;\n  }\n\n  /**\n   * Yelp Search API request\n   * https://www.yelp.com/developers/documentation/v2/search_api\n   * @param {object} params\n   * @param {function} callback\n   * @returns {Promise}\n   */\n  search(params, callback) {\n    return this.get('search', params, callback);\n  }\n\n  /**\n   * Yelp Business API request\n   * https://www.yelp.com/developers/documentation/v2/business\n   * @param {string} id - The business id at Yelp\n   * @param {function} callback\n   * @returns {Promise}\n   */\n  business(id, callback) {\n    return this.get(`business/${id}`, undefined, callback);\n  }\n\n  /**\n   * Yelp Phone Search API request\n   * https://www.yelp.com/developers/documentation/v2/phone_search\n   * @param {object} params - The object containing the phone\n   * @param {string} params.phone - The phone string, eg \"+12223334444\"\n   * @param {function} callback\n   * @returns {Promise}\n   */\n  phoneSearch(params, callback) {\n    return this.get('phone_search', params, callback);\n  }\n\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Yelp.js\n **/","module.exports = require(\"querystring\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"querystring\"\n ** module id = 7\n ** module chunks = 0\n **/","module.exports = require(\"oauth\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"oauth\"\n ** module id = 8\n ** module chunks = 0\n **/","module.exports = require(\"lodash\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"lodash\"\n ** module id = 9\n ** module chunks = 0\n **/","module.exports = require(\"express\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express\"\n ** module id = 10\n ** module chunks = 0\n **/","module.exports = require(\"cluster\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"cluster\"\n ** module id = 11\n ** module chunks = 0\n **/","module.exports = require(\"os\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"os\"\n ** module id = 12\n ** module chunks = 0\n **/"],"sourceRoot":""}